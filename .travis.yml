#https://docs.travis-ci.com/user/customizing-the-build/
#compilers in Travis: https://jonasw.de/blog/2015/07/22/develop/cplusplus14-on-travis-with-cmake/
#also: http://genbattle.bitbucket.org/blog/2016/01/17/c++-travis-ci/
#Coverity: https://scan.coverity.com/travis_ci
# script: 

language: cpp
sudo: false

env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "dM/Hc5Eua/BOCYoaS7wgXocOMQzrjqv60VzGYbkDDO0UcA6dNLl3AUpHCH4hIb63PubcL5vkwEy4JxevYAQgN2n3AVzzWvNbtFO+KRMJ/ShV23ylpoFqrkkSnRnFl1eP7K+YVE6crPG5zEYHMPDOhL7+7WWBSbBnV3fP712Ol1hEy0mWnJVsrrl/A0RhFAT+EFmWbYszT4MFJSLRmJ3WFVH51v8S4ngOha+JW3VHnoo5lKMLEpVpZTGIGan7ydMDt4f/IASCo8L/z+4H7QHZtZEU1gYbYlR08j04NUHZ9LxxFbvwJWcFmo1ek8eHmNEdd2SUMnOHbbBq1xyaiyuGCuKmRY7CaOdo3WVab4EkJgefs+F0rmle/eAwjEF7pVTGpDXxUTX5epe3EgaNdNP/gUW121iNu+sLBo9Nbv66QtHZf6FVZ8Yi5FMgQcu2tYBF/9r5AUDtYuPXtbkYBk9s4S2dH0W6zMFvUpxYVzGLrhIRxAsDgBEujjujErQs/MFvIX1E3VekDAp/ociGqAzA0ojsDBDKu8qWqgDeJvnjjQhBer/b4EtsdYFpnrzvHfauiQDIb5t7aBDg5Zhtkpxcvwaj37quDhREY6Lpn8Xo6HkJwQX/qqa9IREDW+BLzZ1KHQAnSvDlvlKVQrgSae0TvGUk2a427fRmYr6wjMIJerk="

addons:
  coverity_scan:
    project:
    name: "Zbyl/ArbitraryFormatSerializer"
    description: "Build submitted via Travis CI"
    notification_email: zbychs@gmail.com
    build_command_prepend: "./ci-builds/prepare-build.sh; cd build-zz"
    build_command:   "if [ "${COMPILER}" == "g++-5" ]; then make; else exit 1; fi"
    branch_pattern: coverity_scan

matrix:
  include:
    - compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-4.9
      env:
        - COMPILER=g++-4.9
        - BOOST_VER=57
    - compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-5
      env:
        - COMPILER=g++-5
        - BOOST_VER=58
    - compiler: clang
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-precise-3.7
          packages:
            - clang-3.7
      env:
        - COMPILER=clang++-3.7
        - BOOST_VER=58
        - BOOST_TOOLSET=clang

before_install:
  #- pip install --user cpp-coveralls

before_script:
  - . ./ci-builds/download-boost.sh $BOOST_VER

script:
  - if [ "${COVERITY_SCAN_BRANCH}" != 1 ]; then ./ci-builds/build.sh ; fi

after_success:
  #- coveralls --exclude lib --exclude tests --gcov-options '\-lp'
